<?php
/*===============================================
–ü–æ—Ç–∫–ª—é—á–∏—Ç—å –æ—à–∏–±–∫—É Hatolarni boglash
===============================================*/

error_reporting(E_ALL);
ini_set('display_error', 'on');

/* ==============================================
 * –ü–æ—Ç–∫–ª—é—á–∏—Ç—å MySqli va PhpAdmini ulash
=================================================*/

$host       = 'localhost';
$name       = 'nextin_boteps';
$password   = '*******';
$db_name    = 'nextin_boteps';

$link = mysqli_connect($host, $name, $password, $db_name);

$query = 'SELECT * FROM botesp WHERE id > 0';

	$result = mysqli_query($link, $query) or die(mysqli_error($link));

	for ($data = []; $row = mysqli_fetch_assoc($result); $data[] = $row);

	
	// $addName     = 'Muxlisa';
	// $addSurname  = 'Malikova';
	// $addEmail    = "******";
	// $addPhone    = "+*****";


// $add = "INSERT INTO botesp SET name='Muxlisa' , surname='Malikova' , email='muxlis@mai.ru' , phone='+9989012345678' ";
// 	mysqli_query($link, $add) or die(mysqli_error($link));



/* ==============================================
–¢–æ–∫–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –º–µ—Ç–æ–¥ —Å–µ–Ω–¥ –º–µ—Å—Å–µ–¥–∂ Tokeni boglimiz
va sendMessage uchun funksiya yasimiz
=================================================*/
//1149464701:AAG3jX51IuG2npZI1PPtnW_xGfMy5wbJjr8
// –¢–æ–∫–µ–Ω—É –±–µ—Ä–µ–º –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É —Å –∏–º–µ–Ω–µ–º 'API KEY'
define('API_KEY', '1149464701:AAG3jX51IuG2npZI1PPtnW_xGfMy5wbJjr8');
// –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–æ–¥–æ–≤
	function botEPS($method, $datas=[]) {
		$url = "https://api.telegram.org/bot".API_KEY."/".$method;
		$ch  = curl_init();
		curl_setopt($ch, CURLOPT_URL, $url);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
		curl_setopt($ch, CURLOPT_POSTFIELDS, $datas);
		$res = curl_exec($ch);

			if (curl_error($ch)) {
				var_dump(curl_error($ch));
			} else {
				return json_decode($res);
			}
	}

// Typing –±–æ—Ç–≥–∞ —Å–º—Å –π–æ–∑–≥–∞–Ω–¥–∞ –∂–∞–≤–æ–± —É—á—É–Ω —á–∏–∫–∞–¥–∏–≥–∞–Ω —è–Ω–∏–π –ø–µ—á–∞—Ç–∞–µ—Ç...
	function typing($ch) {
		return botEPS('sendChatAction', [
			'chat_id'   => $ch,
			'action'    => 'typing',
		]);
	}


/*===============================================
–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á—É–Ω —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä
=================================================*/
//Userdan olingan malumotlarni o'chirib tashlaydigan funksiya
//–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç —Ç–æ —á—Ç–æ –≤–≤–æ–¥–∏—Ç –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª—å
	function del($chatID) {
		unlink("step/$chatID.menu");
		unlink("step/$chatID.step");
		unlink("step/$chatID.txt");
	}

// Bu funksiya step papkadan step nomli fayl ochadi va unga qiymat berib ketadi
//–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤ –ø–∞–ø–∫–µ step —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ step —Å–æ —Å–Ω–∞—á–µ–Ω–∏–µ–º
	function pstep($chatID, $svalue) {
		file_put_contents("step/$chatID.step", $svalue);
	}

// Bu funksiya menu papkadan step nomli fayl ochadi va unga qiymat berib ketadi
//–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤ –ø–∞–ø–∫–µ menu —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ menu —Å–æ —Å–Ω–∞—á–µ–Ω–∏–µ–º
	function pmenu($chatID, $mvalue) {
		file_put_contents("step/$chatID.menu", $mvalue);
	}

//Bu funksiya owa step ochilgan fayldagi qiymatni bittaga owirib boradi
//–§–∏–Ω–∫—Ü–∏—è —É–º–Ω–æ–∂–∞–µ—Ç —Å—Ç–µ–ø–∞ –Ω–µ 1 –∫—É
	function step($chatID) {
		$step = file_get_contents("step/$chatID.step");
		$step += 1;
		file_put_contents("step/$chatID.step", $step);
	}

//–î–õ—è –Ω–∞–∑–∞–¥
// Orqaga qaytish uchun funkisiya yaniy stepdan 1 ta kamaytiradi
	function minustep($chatID) {
		$step = file_get_contents("step/$chatID.step");
		$step -= 1;
		file_put_contents("step/$chatID.step", $step);
	}

//Bu funksiya userdan kelgan smslarni yigib boradi
//–≠—Ç–æ —Ñ—É–Ω–∫—ã–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç—å —Å–º—Å–∫–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
	function sendTXT($chatID, $TXT) {
		$step = file_get_contents("step/$chatID.txt");
		file_put_contents("step/$chatID.txt", "$step\n$TXT");
	}

//
//
	function ACL($callbackQueryId, $text=null, $showAlert = false) {
		return bot('answerCallbackQuery', [
			'callback_query_id' => $callbackQueryId,
			'text' => $text,
			'show_alert' => $showAlert,
		]);
	}


/*========================================================
 –§—É–µ–∫—Ü–∏—è–ª–∞—Ä –∞–¥–¥—Ä–µ—Å —É—á—É–Ω Addresses
==========================================================*/

$update = json_decode(file_get_contents('php://input'));
	$message       = $update->message;
	$chatID        = $message->chat->id;
	$MChatType     = $message->chat->type;
	$messageID     = $message->message_id;
	$name          = $message->chat->first_name;
	$Uname         = $message->from->username;
	$messageTXT    = $message->text;
	$callback      = $update->callback_query;
	$callimID      = $callback->inline_message_id;
	$callmessage   = $callback->message;
	$callmessageID = $callmessage->message_id;
	$callmessageTXT= $callmessage->text;
	$callMChatID   = $callback->message->chat->id;
	$callFromID    = $callback->from->id;
	$callFromUname = $callback->from->username;
	$callData      = $callback->data;
	$callID        = $callback->id;
	$call_queryID  = $update->callback_query->id;
	$callChat_ins  = $callback->chat_instance;
	$callMChatType = $callback->message->chat->type;
	$step          = file_get_contents("step/$chatID.step");
	$menu          = file_get_contents("step/$chatID.menu");
	$stepe         = file_get_contents("step/$callFromID.step");
	$menue         = file_get_contents("step/$callFromID.menu");
	$sendMess      = file_get_contents("step/$chatID.txt");
 	mkdir("step");


/*================================================================
Keyboards         Klaishlar        –ö–ª–∞–≤–∏—à–∏
==================================================================*/

//–ö–ª–∞–≤–∏—à–∏ –¥–ª—è –≥–ª–∞–≤–Ω–∞—è
//Asosiy saxifani knopkalari
$keyboards = json_encode([
	'resize_keyboard' => true,
	'keyboard' => [
		[['text' => "–ë—É—é—Ä—Ç–º–∞ –±–µ—Ä–∏—à\n(–ó–∞–∫–∞–∑–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞)"],],
		[['text' => "–ë–∏–∑ —Ö–∞“õ–∏–º–∏–∑–¥–∞\n(–û –Ω–∞—Å)"], ['text' => "–ú—É–ª–æ“õ–∞—Ç —û—Ä–Ω–∞—Ç–∏—à\n(–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)"]],
		[['text' => "–ú–∞–Ω–∑–∏–ª–∏–º–∏–∑\n(–ù–∞—à –∞–¥—Ä–µ—Å)"], ['text' => "–†—û–π—Ö–∞—Ç–¥–∞–Ω —û—Ç–∏—à\n(–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)"],],
	]
]);


//–û—Ç–º–µ–Ω–∏—Ç—å
//Bekor qilish
$cencle = json_encode([
	'resize_keyboard' => true,
	'keyboard' => [
		[['text' => "–ë–µ–∫–æ—Ä –∫–∏–ª–∏—à\n(–û—Ç–º–µ–Ω–∏—Ç—å)"],],
	]
]);

//–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å
//Manzil qoshish va yuborish
$address = json_encode([
	'resize_keyboard' => true,
	'keyboard' => [
		[['text' => "–ê—Å–æ—Å–∏–π —Å–∞—Ö–∏—Ñ–∞\n(–ì–ª–∞–≤–Ω–∞—è)"],['text' => "–ë—É—é—Ä—Ç–º–∞–Ω–∏ —é–±–æ—Ä–∏—à\n(–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑)"],],
	]
]);




/*==================================================================
–¢–∞–π–ø–∏–Ω–≥ —Ñ—É–µ–∫—Å–∏—è—Å–∏ –∏—à–ª–∞—Ç–∞–º–∏–∑
====================================================================*/
	if (isset($messageTXT)) {
		typing($chatID);
	}

/*===================================================================
–ë–∞—Ç–Ω–ª–∞–Ω–∏ –∏—à–ª–∞—Ç–∞–º–∏–∑
======================================================================*/

// Start –°—Ç–≤—Ä—Ç

	if ($messageTXT == "/start")  {
		botEPS('sendMessage', [
			'chat_id' => $chatID,
			'text'    => "–ê—Å—Å–∞–ª–æ–º—É –ê–ª–∞–π–∫—É–º $name!",
			'parse_mode' => 'markdown',
			'reply_markup' => $keyboards,
		]);
	}

// Home –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã

	if ($messageTXT == "/home") {
		botEPS('sendMessage', [
			'chat_id'      => $chatID,
			'text'         => "‚Äú–≠–ö–°–ü–†–ï–°–° –ü–û–ß–¢–ê –°–ò–†–î–ê–†–Å‚Äù –ú–ß–ñ",
			'parse_mode'   => 'markdown',
			'reply_markup' => $keyboards,
  		]);
	}


/*===============================================================
–ë—É—é—Ä—Ç–º–∞ –±–µ—Ä–∏—à (–ó–∞–∫–∞–∑–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞)
===============================================================*/

	if ($messageTXT == "–ë—É—é—Ä—Ç–º–∞ –±–µ—Ä–∏—à\n(–ó–∞–∫–∞–∑–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞)") {
		botEPS('sendMessage', [
			'chat_id'      => $chatID,
			'text'         => "<b>- –û–ª–∏–± –∫–µ—Ç–∏—à –º–∞–Ω–∑–∏–ª–∏ –≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ —ë–∑–∏–Ω–≥:</b>\n<u>–ú–∞—Å–∞–ª–∞–Ω:</u><i>–ì—É–ª–∏—Å—Ç–æ–Ω —à. \"–°–∞–π–∫–∞–ª\" –º–∞—Ö–∞–ª–ª–∞—Å–∏ –Å—à–ª–∏–∫ –∫—û—á–∞—Å–∏ 56. —Ç–µ–ª. 90 255-33-83</i>",
			'parse_mode'   => 'html',
			'reply_markup' => $cencle,
		]);
		pstep($chatID, "0");
		pmenu($chatID, "buyurtma");
	}

	if ($step == "0" and $menu == "buyurtma") {
		if ($messageTXT == "–ë–µ–∫–æ—Ä –∫–∏–ª–∏—à\n(–û—Ç–º–µ–Ω–∏—Ç—å)") {
			del($chatID);

			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => '–°–∏–∑ –±—É—é—Ä—Ç–º–∞–Ω–∏ –±–µ–∫–æ—Ä –∫–∏–ª–¥–∏–Ω–≥–∏–∑ –≤–∞ –∞—Å–∞—Å–∏–π —Å–∞—Ö–∏—Ñ–∞–≥–∞ –∫–∞–π—Ç–∏–Ω–≥–∏–∑',
				'parse_mode'     => 'html',
				'reply_markup'   => $keyboards,
			]);
		} else {
			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => "<b>-–ï—Ç–∫–∞–∑–∏–± –±–µ—Ä–∏—à –º–∞–Ω–∑–∏–ª–∏ –≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ —ë–∑–∏–Ω–≥:</b>\n<u>–ú–∞—Å–∞–ª–∞–Ω:</u><i> –ì—É–ª–∏—Å—Ç–æ–Ω —à. \"–°–∞–π–∫–∞–ª\" –º–∞—Ö–∞–ª–ª–∞—Å–∏ –Å—à–ª–∏–∫ –∫—û—á–∞—Å–∏ 56. —Ç–µ–ª. 90 255-33-83</i>",
				'parse_mode'     => 'html',
				'reply_markup'   => $cencle,
			]);
			sendTXT($chatID, "üìç–û–ª–∏–± –∫–µ—Ç–∏—à –º–∞–Ω–∑–∏–ª–∏: ".$messageTXT);
			step($chatID);
		}
	}


	if ($step == "1" and $menu == "buyurtma") {
		if ($messageTXT == "–ë–µ–∫–æ—Ä –∫–∏–ª–∏—à\n(–û—Ç–º–µ–Ω–∏—Ç—å)") {
			del($chatID);

			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => '–°–∏–∑ –±—É—é—Ä—Ç–º–∞–Ω–∏ –±–µ–∫–æ—Ä –∫–∏–ª–¥–∏–Ω–≥–∏–∑ –≤–∞ –∞—Å–∞—Å–∏–π —Å–∞—Ö–∏—Ñ–∞–≥–∞ –∫–∞–π—Ç–∏–Ω–≥–∏–∑',
				'parse_mode'     => 'html',
				'reply_markup'   => $keyboards,
			]);
		} else {
			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => "<b>–ü–æ—á—Ç–∞ —é–∫–∏–Ω–∏–Ω–≥ —Ç—É—Ä–∏ –≤–∞ —É–Ω–∏–Ω–≥ —É–ª—á–∞–º–ª–∞—Ä–∏: </b><u>Masalan: </u><i>Xat va xujjatlar A4</i>",
				'parse_mode'     => 'html',
				'reply_markup'   => $cencle,
			]);
			sendTXT($chatID, "üìç–ï—Ç–∫–∞–∑–∏–± –±–µ—Ä–∏—à –º–∞–Ω–∑–∏–ª–∏: ".$messageTXT);
			step($chatID);
		}
	}

	if ($step == "2" and $menu == "buyurtma") {
		if ($messageTXT == "–ë–µ–∫–æ—Ä –∫–∏–ª–∏—à\n(–û—Ç–º–µ–Ω–∏—Ç—å)") {
			del($chatID);

			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => '–°–∏–∑ –±—É—é—Ä—Ç–º–∞–Ω–∏ –±–µ–∫–æ—Ä –∫–∏–ª–¥–∏–Ω–≥–∏–∑ –≤–∞ –∞—Å–∞—Å–∏–π —Å–∞—Ö–∏—Ñ–∞–≥–∞ –∫–∞–π—Ç–∏–Ω–≥–∏–∑',
				'parse_mode'     => 'html',
				'reply_markup'   => $keyboards,
			]);
		} else {
			botEPS('sendMessage', [
				'chat_id'        => $chatID,
				'text'           => "<b>–°–∏–∑–Ω–∏–Ω–≥ –±—É—é—Ä—Ç–º–∞–Ω–≥–∏–∑ –∫–∞–±—É–ª –∫–∏–ª–∏–Ω–¥–∏!\n–ë—É—é—Ä—Ç–º–∞–Ω–∏ —é–±–æ—Ä–∏—à–∏–Ω–≥–∏–∑ –º—É–º–∫–∏–Ω</b>",
				'parse_mode'     => 'html',
				'reply_markup'   => $address,
			]);
			sendTXT($chatID, "üì¶–ü–æ—á—Ç–∞ —é–∫–∏–Ω–∏–Ω–≥ —Ç—É—Ä–∏ –≤–∞ —É–Ω–∏–Ω–≥ —É–ª—á–∞–º–ª–∞—Ä–∏: ".$messageTXT);
			step($chatID);
		}
	}


	if ($messageTXT == "–ê—Å–æ—Å–∏–π —Å–∞—Ö–∏—Ñ–∞\n(–ì–ª–∞–≤–Ω–∞—è)") {
		del($chatID);

		botEPS('sendMessage', [
			'chat_id'            => $chatID,
			'text'               => "–°–∏–∑ –±—É—é—Ä—Ç–º–∞–Ω–∏ –±–µ–∫–æ—Ä –∫–∏–ª–¥–∏–Ω–≥–∏–∑ –≤–∞ –∞—Å–∞—Å–∏–π —Å–∞—Ö–∏—Ñ–∞–≥–∞ –∫–∞–π—Ç–∏–Ω–≥–∏–∑" ,
			'parse_mode'         => 'html',
			'reply_markup'       => $keyboards,
		]);
	}


	if ($messageTXT == "–ë—É—é—Ä—Ç–º–∞–Ω–∏ —é–±–æ—Ä–∏—à\n(–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑)") {
		botEPS('sendMessage', [
			'chat_id'       => '-1001448501379',
			'text'          => "$name –Ω–∏–Ω–≥ –±—É—é—Ä—Ç–º–∞—Å–∏\n$sendMess",
			'parse_mode'    => 'markdown',
	    ]);

	    del($chatID);

		botEPS('sendMessage', [
			'chat_id'        => $chatID,
			'text'           => "–°–∏–∑–Ω–∏–Ω–≥ –±—É—é—Ä—Ç–º–∞–Ω–≥–∏–∑ —é–±–æ—Ä–∏–ª–¥–∏ –≤–∞ —Å–∏–∑ –∞—Å–æ—Å–∏–π —Å–∞—Ö–∏—Ñ–∞–≥–∞ –∫–∞–π—Ç–∏–Ω–≥–∏–∑",
			'parse_mode'     => 'html',
			'reply_markup'   => $keyboards,
		]);

	}
//Chat ID kuryerlar o'tiradigan gruppaniki
// –ß–∞—Ç –∞–π–¥–∏ –∫–∞—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–∞–∑—è–Ω –∫—É—Ä–µ—Ä–æ–≤
// -1001448501379


/*===============================================================
–ë–∏–∑ —Ö–∞“õ–∏–º–∏–∑–¥–∞ (–û –Ω–∞—Å)
===============================================================*/

	if ($messageTXT == "–ë–∏–∑ —Ö–∞“õ–∏–º–∏–∑–¥–∞\n(–û –Ω–∞—Å)") {
		botEPS('sendMessage', [
			'chat_id'       => $chatID,
			'text'          => "¬´–≠–∫—Å–ø—Ä–µ—Å—Å –ø–æ—á—Ç–∞ –°–∏—Ä–¥–∞—Ä—ë¬ª –ú–ß–ñ\n–•–∞—Ç, —Ö—É–∂–∂–∞—Ç –≤–∞ —é–∫–ª–∞—Ä–Ω–∏ –µ—Ç–∫–∞–∑–∏–± –±–µ—Ä—É–≤—á–∏–ª–∞—Ä —Ç–∏–∑–∏–ª–º–∞—Å–∏.",
			'parse_mode'    => 'markdown',
			// 'reply_markup'  => $exit, –ú—ã —É–±—Ä–∞–ª–∏ —Ç–æ—á–Ω–µ–µ –æ—Ç–∫—é—á–∏–ª–∏ –∫–ª–∞–≤–∏—à –∫–∞–π—Ç–∏—à
		]);
	}

/*===============================================================
–ú–∞–Ω–∑–∏–ª–∏–º–∏–∑ (–ù–∞—à –∞–¥—Ä–µ—Å)
===============================================================*/

	if ($messageTXT == "–ú–∞–Ω–∑–∏–ª–∏–º–∏–∑\n(–ù–∞—à –∞–¥—Ä–µ—Å)") {
		botEPS('sendLocation', [
			'chat_id'       => $chatID,
			'latitude'      => 40.503434,
			'longitude'     => 68.778324,
		]);
	}

		if ($messageTXT == "–ú–∞–Ω–∑–∏–ª–∏–º–∏–∑\n(–ù–∞—à –∞–¥—Ä–µ—Å)") {
		botEPS('sendMessage', [
			'chat_id'       => $chatID,
			'text'          => "<b>120 100</b> –°–∏—Ä–¥–∞—Ä—ë –≤–∏–ª–æ—è—Ç–∏ –ì—É–ª–∏—Å—Ç–æ–Ω —à–∞—Ö—Ä–∏. –Å—à–ª–∏–∫ –∫—û—á–∞—Å–∏ 56 (7-–º–∞–∫—Ç–∞–± —ë–Ω–∏)",
			'parse_mode'    => 'html',
		]);
	}

/*===============================================================
–ú—É–ª–æ“õ–∞—Ç —û—Ä–Ω–∞—Ç–∏—à (–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)
===============================================================*/

	if ($messageTXT == "–ú—É–ª–æ“õ–∞—Ç —û—Ä–Ω–∞—Ç–∏—à\n(–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)") {
		botEPS('sendContact', [
			'chat_id'       => $chatID,
			'phone_number'  => '+99867 225 56 66',
			'first_name'    => '–û—Ñ–∏—Å',
		]);
	}

		if ($messageTXT == "–ú—É–ª–æ“õ–∞—Ç —û—Ä–Ω–∞—Ç–∏—à\n(–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)") {
		botEPS('sendContact', [
			'chat_id'       => $chatID,
			'phone_number'  => '+99893 324 56 66',
			'first_name'    => '–ú–æ–±–∏–ª—å–Ω—ã–π',
		]);
	}

/*=======================================================
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Ro'yxatdan o'tish
=======================================================*/


if ($messageTXT == "rasm") {
	botEPS('sendPhoto', [
		'chat_id' => $chatID,
		'photo'   => "https://farshoh.uz/nextinuzbotphoto/nextinuzbot.jpg",
	]);
}



?>
